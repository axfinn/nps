## [0.26.43] - 2025-07-28

### 新增

-

## [0.26.42] - 2025-07-28

### 新增
- 使用构建脚本发布
- 优化版本发布流程
- 增强发布脚本功能

# 变更日志

## [0.26.41] - 2025-07-28

### 修复
- 修复登录验证码验证失败问题
  - 修复在web_base_url配置情况下验证码验证失败的问题
  - 优化验证码验证逻辑，确保无论是否配置web_base_url都能正确验证
  - 增强验证码验证日志输出，便于问题排查

## [0.26.40] - 2025-07-28

### 修复
- 修复登录验证时验证码不通过的问题
  - 修复在web_base_url配置情况下验证码验证失败的问题
  - 确保Verify方法中正确初始化验证码路由
  - 优化验证码路由处理逻辑，保证登录验证正常工作

## [0.26.39] - 2025-07-28

### 修复
- 修复登录验证时验证码不通过的问题
  - 修复在web_base_url配置情况下验证码验证失败的问题
  - 确保Verify方法中正确初始化验证码路由
  - 优化验证码路由处理逻辑，保证登录验证正常工作

## [0.26.38] - 2025-07-28

### 修复
- 修复nps启动时-conf_path参数不生效的问题
  - 修复命令行参数解析逻辑，确保-conf_path参数能正确设置配置文件路径
  - 优化配置文件路径处理，提高程序的可用性和灵活性
  - 确保用户可以通过-conf_path参数指定配置文件目录

## [0.26.37] - 2025-07-28

### 修复
- 修复新项目部署后登录页面验证码异常问题
  - 修复web_base_url为空时验证码路由处理不当的问题
  - 确保无论是否配置web_base_url验证码都能正常显示和验证
  - 优化验证码路由拼接逻辑，避免路径错误

## [0.26.36] - 2025-07-28

### 优化
- 更新.gitignore文件，忽略编译生成的二进制文件和相关目录
  - 忽略dist/、downloads/和web/static/downloads/目录
  - 避免将编译生成的文件提交到版本控制系统中
  - 保持仓库清洁，减小仓库体积

## [0.26.35] - 2025-07-28

### 修复
- 修复部分页面出现502错误的问题
  - 修复JavaScript中web_base_url为空时导致的路径错误
  - 确保在未配置web_base_url时页面也能正常工作
  - 修复Cookie路径设置问题

## [0.26.34] - 2025-07-28

### 修复
- 修复登录页面验证码图片显示502错误问题
  - 修复在配置web_base_url时验证码路由不正确的问题
  - 确保验证码图片能正确显示，无论是否配置web_base_url

## [0.26.33] - 2025-07-28

### 修复
- 修复Docker Hub镜像版本标签问题
  - 修复GitHub Actions工作流中的环境变量设置错误
  - 确保在版本发布时正确提取版本号作为Docker镜像标签
  - 修复master分支推送时标记为latest的逻辑

## [0.26.32] - 2025-07-28

### 新增
- 增强Docker镜像自动构建功能
  - 更新GitHub Actions工作流，支持master分支推送自动构建
  - 改进Dockerfiles，使用alpine基础镜像减小镜像体积
  - 在镜像中包含默认配置文件，简化容器启动过程
  - 添加容器默认端口暴露和启动命令

## [0.26.31] - 2025-07-28

### 优化
- 清理无用代码和文件
  - 删除lib/version目录下的无用脚本文件
  - 清理仓库中的临时文件和未跟踪文件
  - 保持代码库整洁，提高维护性

### 修复
- 修复变更日志格式问题
  - 修复标题格式错误问题

## [0.26.30] - 2025-07-28

### 新增
- 添加Docker容器升级脚本
  - 创建upgrade_nps.sh脚本，实现一键升级NPS容器
  - 脚本包含配置备份、容器停止、镜像更新、容器重启等完整流程
  - 添加升级结果验证和日志输出功能

### 修复
- 修复下载页面多语言支持问题
  - 修复控制器中模板引用错误，确保正确加载多语言资源
  - 确保所有页面元素通过langtag属性正确标记实现多语言支持

## [0.26.29] - 2025-07-28

### 优化
- 改进客户端版本检查逻辑，支持向后兼容连接
  - 服务端现在可以接受0.26.0及以上版本的客户端连接
  - 添加版本兼容性检查函数，确保连接的客户端版本兼容
  - 优化版本检查日志记录，便于问题排查

## [0.26.28] - 2025-07-28

### 修复
- 修复Docker镜像自动构建失败问题
  - 修复GitHub Actions工作流中的环境变量设置问题
  - 修复标签格式不正确导致构建失败的问题
  - 改善版本号提取逻辑，确保正确构建和标记Docker镜像

## [0.26.27] - 2025-07-27

### 新增
- Docker镜像自动构建功能
  - 添加GitHub Actions工作流，实现多平台Docker镜像自动构建
  - 支持linux/amd64、linux/arm、linux/arm64平台
  - 自动推送latest和版本标签镜像到Docker Hub

## [0.26.26] - 2025-07-26

### 优化
- 核心性能优化：减少锁竞争，使用原子操作替代部分锁操作，优化sync.Map遍历效率
- 流量统计优化：
  - 在Flow结构体中添加AtomicAdd和GetFlow方法，使用原子操作更新流量统计，避免锁竞争
  - 在BaseServer中添加FlowAddAtomic和FlowAddHostAtomic方法，使用原子操作更新流量
- 连接数管理优化：
  - 在Client结构体中优化GetConn方法，使用atomic.LoadInt32直接读取连接数，避免不必要的锁
  - 添加GetNowConn方法，用于原子地获取当前连接数
- sync.Map遍历优化：
  - 优化storeSyncMapToFile函数，使用goroutine和channel并行处理数据序列化和文件写入
  - 减少锁的持有时间，提高并发性能
- 服务器数据统计优化：
  - 在GetDashboardData函数中使用原子操作统计客户端连接数，避免锁竞争
- 接口实现修复：
  - 修复Bridge结构体，确保正确实现NetBridge接口

### 版本更新
- 项目版本从 v0.26.25 更新至 v0.26.26

## 2025-07-26

### 优化
- 简化 README.md 文件，移除过时和不必要的信息
- 更新 go.mod 文件，升级 beego 框架到 v2 版本
- 重构 server/server.go 文件，将全局变量封装到 Server 结构体中
- 在 proxy/base.go 中添加上下文支持，实现优雅关闭
- 在 common/util.go 中添加密码安全功能，使用 Argon2 算法进行密码哈希

### 依赖更新
- 更新 beego 从 v1.12.0 到 v2.1.0
- 更新 kcp-go 到 v5.4.20 正确版本
- 添加 golang.org/x/crypto 依赖用于密码安全功能

### 代码结构改进
- 引入 Server 结构体和单例模式管理服务实例
- 重构全局变量访问方式，提高代码可维护性
- 添加上下文支持，实现更好的资源管理

### 兼容性更新
- 更新所有 beego 导入路径以适配 v2 版本
- 修正相关 API 调用以符合新版本
### Bug修复
- 修复 npc_gui.go 中的 fmt.Errorf 参数不匹配问题
- 解决 cmd/npc 目录中 main 函数重复声明的问题
- 修复 config 包的测试用例问题

### 测试改进
- 修复 pmux 包中的端口冲突问题，更改测试端口从 8888 到 8899
- 修改 pmux 包避免在测试环境中直接调用 os.Exit
- 修改 nps_mux 包测试，使用本地回环地址替代 Docker 网络地址
- 为需要特定网络配置的测试添加跳过条件，提高测试可执行性
- 修复 nps_mux 包测试中的变量使用问题和导入问题